#!/bin/bash
#
# Under CC0 license: https://creativecommons.org/publicdomain/zero/1.0/
# To the extent possible under law, GoSecure Inc. has waived all copyright and
# related or neighboring rights to this script.
# Olivier Bilodeau <obilodeau@gosecure.ca>
#
source .config.sh

function print_usage() {
	echo -e "$0: Usage\n"
	echo -e "push: Send pcaps to the server"
	echo -e "pull: Fetch pcaps from the server"
}

if [[ "z$PCAP_DST" == "z" ]]; then
	echo -e "$0: Missing configuration\n"
	echo -ne "Please define the PCAP_DST variable in the .config.sh file."
	echo -e "Check README.adoc for details.\n"
	exit 1
fi

if [[ $# -ne 1 ]]; then
	print_usage;
	exit 2
fi

if [[ "z$1" == "zpull" ]]; then
	/usr/bin/rsync -Ptr $PCAP_DST pcaps/
elif [[ "z$1" == "zpush" ]]; then
	/usr/bin/rsync -Ptr pcaps/ $PCAP_DST
else
	print_usage
	exit 3
fi
